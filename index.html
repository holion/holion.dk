<html>
<script>
    var bits = [];
    var hiddenBits = [];
    var offBits = [];
    var holionBits = [];
    var visibleBit;
    var currentBitIndex;
    var showBitTimer;
    const steps = {
        WARM_UP: 'warmup',
        RUNNING_FASTER: 'runningfaster',
        OFF: 'off',
        ON: 'on',
        LOGO_STEP_1: 'step1',
        LOGO_STEP_2: 'step2',
        LOGO_STEP_3: 'step3',
        LOGO_STEP_4: 'step4',
        LOGO_STEP_5: 'step5',
        LOGO_STEP_6: 'step6',
        LOGO_STEP_7: 'step7',
        LOGO_HOLION: 'holion',
        LOGO_HOLION_WITH_LEAF: 'holion_with_leaf'
    }
    const colors = {
        WHITE: 'white',
        BLACK: 'black',
        GREY: '#222222',
        LIGHTGREY: 'lightgrey',
        RED: '#A90027',
        GREEN: '#61A836',
        DARK: '#484848'
    }
    let step = steps.WARM_UP;
    let delay = 1500;
    let rowCount = 11;
    let drawLetterSpeed = 500;

    function log(message) {
        console.log(message);
    }

    function create(text) {
        var element = document.createElement('canvas');
        element.height = 100;
        var ctx = element.getContext('2d');
        ctx.beginPath();

        element.off = function () {
            ctx.clearRect(0, 0, element.width, element.height);
            ctx.strokeStyle = colors.GREY;
            ctx.stroke();
        }

        element.on = function (color) {
            ctx.clearRect(0, 0, element.width, element.height);

            ctx.strokeStyle = color ?? colors.LIGHTGREY;
            ctx.stroke();
        }

        element.normal = function () {
            ctx.clearRect(0, 0, element.width, element.height);

            ctx.strokestyle = colors.GREY;
            ctx.stroke();
        }

        element.hide = function () {
            if (holionBits.indexOf(element) > -1)
                return;

            element.style.visibility = 'hidden';
        }

        if (text === 0) {
            element.width = 115;

            ctx.arc(50, 50, 30, 0, 2 * Math.PI);
        }
        else if (text === 1) {
            element.width = 40;

            ctx.moveTo(10, 10);
            ctx.lineTo(10, 90);
        }
        else if (text === 2) {
            element.width = 60;

            ctx.moveTo(10, 10);
            ctx.lineTo(10, 90);
        }
        else if (text === 'H') {
            element.width = 100;

            element.drawInitial = function () {
                ctx.moveTo(10, 10);
                ctx.lineTo(10, 90);
                ctx.stroke();

                ctx.moveTo(70, 10);
                ctx.lineTo(70, 90);
            }

            element.draw = function () {
                ctx.moveTo(10, 50);
                ctx.lineTo(70, 50);
                ctx.stroke();
            }

            element.highlight = function () {
                ctx.beginPath();

                ctx.moveTo(70, 10);
                ctx.lineTo(70, 90);

                ctx.strokeStyle = colors.DARK;
                ctx.stroke();
            }

            element.highlightTheRest = function () {
                ctx.clearRect(0, 0, element.width, element.height);

                element.drawInitial();

                ctx.strokeStyle = colors.DARK;
                ctx.stroke();
            }

            element.drawInitial();
        }
        else if (text === 'o') {
            element.width = 115;

            ctx.arc(50, 50, 30, 0, 2 * Math.PI);

            element.highlight = function () {
                ctx.strokeStyle = colors.DARK;
                ctx.stroke();
            }
        }
        else if (text === 'l') {
            element.width = 80;

            ctx.moveTo(10, 10);
            ctx.lineTo(10, 90);

            element.draw = function () {
                ctx.moveTo(10, 78);
                ctx.lineTo(55, 78);
                ctx.stroke();
            }

            element.highlight = function () {
                ctx.strokeStyle = colors.DARK;
                ctx.stroke();
            }
        }
        else if (text === 'i') {
            element.width = 40;

            ctx.moveTo(10, 10);
            ctx.lineTo(10, 90);

            element.highlight = function () {
                ctx.strokeStyle = colors.DARK;
                ctx.stroke();
            }
        }
        else if (text === 'n') {
            element.width = 100;

            element.drawInitial = function () {
                ctx.moveTo(10, 10);
                ctx.lineTo(10, 90);
                ctx.stroke();

                ctx.moveTo(70, 10);
                ctx.lineTo(70, 90);
                ctx.stroke();

                ctx.lineWidth = 25;
            }

            element.draw = function (color) {
                ctx.moveTo(0, 0);
                ctx.lineTo(74, 90);

                ctx.lineWidth = 25;
                ctx.strokeStyle = color ?? colors.GREEN;
                ctx.stroke();

                // Remove unwanted line endings
                ctx.beginPath();
                // Top
                ctx.moveTo(0, 0);
                ctx.lineTo(30, 0);
                // Bottom
                ctx.moveTo(50, 100);
                ctx.lineTo(80, 100);
                // Right
                ctx.moveTo(92, 0);
                ctx.lineTo(92, 100);
                ctx.lineWidth = 20;
                ctx.strokeStyle = colors.WHITE;
                ctx.stroke();
                ctx.beginPath();
            }

            element.on = function () {
                ctx.clearRect(0, 0, element.width, element.height);
                element.drawInitial();
                element.draw();
                ctx.strokeStyle = colors.GREEN;
                ctx.stroke();
            }

            element.normal = function () {
                ctx.clearRect(0, 0, element.width, element.height);
                ctx.beginPath();

                element.drawInitial();
                ctx.strokeStyle = colors.LIGHTGREY;
                ctx.stroke();
            }

            element.highlight = function () {
                ctx.beginPath();

                ctx.moveTo(10, 10);
                ctx.lineTo(10, 90);

                ctx.strokeStyle = colors.DARK;
                ctx.stroke();
            }

            element.highlightTheRest = function () {
                ctx.clearRect(0, 0, element.width, element.height);

                element.drawInitial();

                ctx.strokeStyle = colors.DARK;
                ctx.stroke();
            }

            element.drawInitial();
        }
        else if (text === 'on') {
            element.width = 115;

            ctx.arc(50, 50, 30, 0, 2 * Math.PI);

            element.on = function () {
                ctx.clearRect(0, 0, 100, 115);
                ctx.strokeStyle = colors.GREEN;
                ctx.stroke();
            }

            element.normal = function () {
                ctx.clearRect(0, 0, 100, 115);
                ctx.strokeStyle = colors.LIGHTGREY;
                ctx.stroke();
            }

            element.highlight = function () {
                ctx.strokeStyle = colors.DARK;
                ctx.stroke();
            }

            element.addLeaf = function () {
                var leafElement = document.createElement('canvas');
                leafElement.height = 100;
                leafElement.width = 100;
                var leafContext = leafElement.getContext('2d');
                leafContext.beginPath();
                leafContext.lineWidth = 1;
                leafContext.strokeStyle = 'red';
                leafContext.fillStyle = colors.GREEN;
                leafContext.moveTo(0, 20);
                leafContext.quadraticCurveTo(10, 0, 40, 20);
                leafContext.fill();
                leafContext.beginPath();
                leafContext.moveTo(0, 20);
                leafContext.quadraticCurveTo(10, 40, 40, 20);
                leafContext.fill();

                leafElement.style.position = 'absolute';
                leafElement.style.left = element.offsetLeft + 80;
                leafElement.style.top = element.offsetTop - 55;
                leafElement.style.transform = 'rotate(-45deg) ';
                element.parentElement.appendChild(leafElement);
            }
        }
        else if (text === 'off') {
            element.width = 115;

            ctx.arc(50, 50, 30, 0, 2 * Math.PI);

            element.off = function () {
                ctx.clearRect(0, 0, element.width, element.height);

                if (offBits.indexOf(element) > -1)
                    ctx.strokeStyle = colors.RED;
                else
                    ctx.strokeStyle = colors.GREY;

                ctx.stroke();
            }
        }
        else if (text === 'f') {
            element.width = 80;

            element.drawInitial = function () {
                ctx.moveTo(10, 10);
                ctx.lineTo(10, 90);
            }

            element.off = function () {
                ctx.clearRect(0, 0, element.width, element.height);

                element.drawInitial();

                if (offBits.indexOf(element) === -1) {
                    ctx.strokeStyle = colors.GREY;
                    ctx.stroke();
                    return;
                }

                ctx.moveTo(0, 22);
                ctx.lineTo(55, 22);

                ctx.moveTo(0, 58);
                ctx.lineTo(55, 58);

                ctx.strokeStyle = colors.RED;

                ctx.stroke();
            }

            element.on = function () {
                ctx.clearRect(0, 0, 80, 100);
                ctx.beginPath();

                element.drawInitial();

                ctx.strokeStyle = colors.LIGHTGREY;
                ctx.stroke();
            }

            element.drawInitial();
        }
        else
            log('unknown character: ' + text)

        ctx.lineWidth = 25;
        ctx.strokeStyle = colors.WHITE;
        ctx.stroke();

        return element;
    }

    function getRandomBit() {
        var random = Math.floor(Math.random() * 6);
        if (random === 2)
            return 2;
        if (random === 3)
            return 'f';

        return random === 0 ? 0 : 1;
    }

    function addChildToRow(introElement, row, newChild) {
        newChild.style.visibility = 'hidden';
        row.appendChild(newChild);

        // The width of the new child is first known when added to the row
        // so it's not possible to skip adding it but instead we can
        // remove it after adding it if the row gets too big
        if (introElement.offsetWidth < row.offsetWidth) {
            row.removeChild(newChild);
            return false;
        }

        bits.push(newChild);
        hiddenBits.push(newChild);

        return true;
    }

    function initialize() {
        var introElement = document.getElementById('intro');

        rowCount = Math.floor(introElement.parentElement.clientHeight / 100);

        for (var rowNo = 0; rowNo < rowCount; rowNo++) {
            var row = document.createElement('span');
            introElement.appendChild(row);
            var count = 0;
            while (introElement.offsetWidth > row.offsetWidth && count < 100) {
                var newChild;
                if (rowNo === Math.floor(rowCount / 2)) {
                    if (count === 0) {
                        offBits = [create('off'), create('f'), create('f')];
                        offBits.forEach(element => {
                            addChildToRow(introElement, row, element);
                        });

                        holionBits = [create('H'), create('o'), create('l'), create('i'), create('on'), create('n')];
                        holionBits.forEach(element => {
                            addChildToRow(introElement, row, element);
                        });

                        [create('off'), create('f'), create('f')].forEach(element => {
                            addChildToRow(introElement, row, element);
                        });
                    }

                    var randomBit = getRandomBit();
                    newChild = create(randomBit);
                    row.insertBefore(newChild, row.firstChild);
                    newChild.style.visibility = 'hidden';
                    if (introElement.offsetWidth < row.offsetWidth) {
                        row.removeChild(newChild);
                        break;
                    }

                    bits.push(newChild);
                    hiddenBits.push(newChild);

                    newChild = create(randomBit);
                }
                else
                    newChild = create(getRandomBit());

                if (!addChildToRow(introElement, row, newChild))
                    break;

                count++;
            }

            introElement.appendChild(document.createElement('br'));
        }

        document.addEventListener('keypress', function (event) {
            step = steps.RUNNING_FASTER;
        });

        // step = steps.RUNNING_FASTER;
        showBit();
    }

    function showBit() {
        if (hiddenBits.length === 0) {
            setTimeout(drawLetters, 500);
            return;
        }

        if (currentBitIndex !== undefined && step === steps.WARM_UP) {
            visibleBit.style.visibility = 'hidden';
            hiddenBits.push(visibleBit);
        }

        currentBitIndex = Math.floor(Math.random() * hiddenBits.length);
        visibleBit = hiddenBits[currentBitIndex];
        visibleBit.style.visibility = '';
        hiddenBits.splice(currentBitIndex, 1);

        showBitTimer = setTimeout(showBit, delay);

        if (step === steps.RUNNING_FASTER && delay > 10)
            delay = delay * 0.75;
    }

    function drawLetters() {
        if (step === steps.RUNNING_FASTER) {
            step = steps.OFF;
            bits.forEach(bit => {
                bit.off();
            });

            showBitTimer = setTimeout(showBit, 500);

            return;
        }
        else if (step === steps.OFF) {
            step = steps.ON;

            document.body.style.backgroundColor = colors.WHITE;

            bits.forEach(bit => {
                bit.on();
            });

            showBitTimer = setTimeout(showBit, 500);

            return;
        }
        else if (step === steps.ON) {
            step = steps.LOGO_STEP_1;

            bits.forEach(bit => {
                bit.normal();
            });

            holionBits[2].highlight();
            holionBits[3].highlight();
        }
        else if (step === steps.LOGO_STEP_1) {
            step = steps.LOGO_STEP_2;

            holionBits[1].highlight();
            holionBits[4].highlight();
        }
        else if (step === steps.LOGO_STEP_2) {
            step = steps.LOGO_STEP_3;

            holionBits[0].highlight();
            holionBits[5].highlight();
        }
        else if (step === steps.LOGO_STEP_3) {
            step = steps.LOGO_STEP_4;

            holionBits[0].highlightTheRest();
            holionBits[5].highlightTheRest();
        }
        else if (step === steps.LOGO_STEP_4) {
            step = steps.LOGO_STEP_5;

            holionBits[5].draw(colors.DARK);
        }
        else if (step === steps.LOGO_STEP_5) {
            step = steps.LOGO_STEP_6;

            holionBits[2].draw();
        }
        else if (step === steps.LOGO_STEP_6) {
            step = steps.LOGO_HOLION;

            holionBits[0].draw();
        }
        else if (step === steps.LOGO_HOLION) {
            step = steps.LOGO_HOLION_WITH_LEAF;

            bits.forEach(bit => {
                bit.hide();
            });

            bits.forEach(bit => {
                bit.on(colors.DARK);
            });
        }
        else if (step === steps.LOGO_HOLION_WITH_LEAF) {
            holionBits[4].addLeaf();
            return;
        }

        showBitTimer = setTimeout(showBit, drawLetterSpeed);
    }

    window.onload = function () {
        initialize();
    }

    window.addEventListener('resize', () => {
        clearTimeout(showBitTimer);
        document.body.style.backgroundColor = 'black';
        document.getElementById('intro').innerHTML = '';
        step = steps.WARM_UP;
        delay = 1500;
        bits = [];
        hiddenBits = [];
        offBits = [];
        holionBits = [];

        initialize();
    });
</script>
<style>
    body {
        background-color: black;
    }

    #intro-container {
        display: flex;
        align-items: center;
        min-height: 80vh;
        max-width: 100vw;
        padding: 50px 200px;
    }

    #intro {
        white-space: nowrap;
        width: 100%;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
    }
</style>

<body>
    <div id="intro-container">
        <div id="intro"></div>
    </div>
</body>

</html>